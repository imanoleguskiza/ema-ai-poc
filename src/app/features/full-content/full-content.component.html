@if (isLoading) {
<header class="jumbotron jumbo">
    <div class="grid--md grid-container--xl">
        <div class="column--10">
            <div><span class="loader-spinner loader-sm fade in" id="exampleLoaderSpinner"></span> Loading details...
            </div>
        </div>
    </div>
</header>
}
@if (!isLoading && mention) {
<header class="jumbotron jumbo">
    <div class="grid--md grid-container--xl">
        <div class="column--10">
            @if (isEditing) {
            <input class="form-control" [(ngModel)]="editableMention!.Title" />
            <textarea class="form-control" rows="4" [(ngModel)]="editableMention!.Detail"></textarea>
            } @else {
            <h1>{{ mention.Title }}</h1>
            <p>{{ mention.Detail }}</p>
            @if (mention.Processed == true) {
            <div class="badge bg-success"><span class="fa fa-check-circle" aria-hidden="true"></span> Processed</div>
            }
            @if (mention.Processed == false) {
            <div class="badge bg-info"><span class="fa fa-times-circle" aria-hidden="true"></span> Not processed</div>
            }
            @if (mention.Classification) {
            <div class="badge bg-info">{{mention.Classification}}</div>
            }
            }
        </div>
    </div>
</header>
<section class="content-area">
    <div class="grid grid-container--lg gutter--md-xl gutter-row--md top-gutter bottom-gutter bg-primary d-flex justify-content-between align-center flex-wrap">
        @if (mention.Processed == true) {
            <div class="column--xs-12 column--xl-10">
                <h3 class="top-gutter bottom-gutter">State: <span class="fa fa-check-circle text-success" aria-hidden="true"></span> Mention processed </h3>
                <p><span class="h5">Classification: </span>{{ mention.Classification }}</p>
                <p class="bottom-gutter"><span class="h5">Justification: </span>{{ mention.Justification }}</p>
            </div>
            <div class="column--xs-12 column--xl-2">
                <button type="button" class="btn btn-success btn-block btn-width-medium top-gutter bottom-gutter"
                        [disabled]="isProcessing"
                        (click)="processMention()">
                    @if (!isProcessing) {
                        <span class="fa fa-play-circle" aria-hidden="true"></span>
                    } @else {
                        <span class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></span>
                    }
                    {{ isProcessing ? 'Processing…' : 'EMA AI Process' }}
                </button>
            </div>
        }
        @if (mention.Processed == false) {
            <div class="column--xs-12 column--xl-10">
                <h3 class="top-gutter bottom-gutter">State: <span class="fa fa-times-circle text-warning" aria-hidden="true"></span>
                    Mention pending processing</h3>
            </div>
            <div class="column--xs-12 column--xl-2">
                <button class="btn btn-success btn-width-medium  btn-block top-gutter bottom-gutter"
                        [disabled]="isProcessing"
                        (click)="processMention()">
                    @if (!isProcessing) {
                        <span class="fa fa-play-circle" aria-hidden="true"></span>
                    } @else {
                        <span class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></span>
                    }
                    {{ isProcessing ? 'Processing…' : 'EMA AI Process' }}
                </button>
            </div>
        }
    </div>
    <div class="grid grid-container--lg gutter--md-xl gutter-row--md top-gutter bottom-gutter">
        <div class="column--xs-12 column--xl-12">
            @if (message) {
                <div class="alert alert-{{alert}} alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>{{ message }}</div>
            }
        </div>
    </div>
    <div class="grid grid-container--lg gutter--md-xl gutter-row--md top-gutter bottom-gutter">
        <div class="column--xs-12 column--xl-9">
            <p><strong>Source:</strong>
                @if (isEditing) {
                <input class="form-control" [(ngModel)]="editableMention!.Source" />
                } @else {
                {{ mention.Source }}
                }
            </p>

            <p><strong>Link: </strong>
                @if (isEditing) {
                <input class="form-control" [(ngModel)]="editableMention!.Link" />
                } @else {
                <a [href]="mention.Link" target="_blank">{{ mention.Link }}</a>
                }
            </p>
            <!--@if (mention.Tags) {
                <p><strong>Tags:</strong></p>
                <ng-container *ngFor="let tag of getTagsArray(mention.Tags)">
                    <span class="badge mr-1">{{ tag }}</span>
                </ng-container>
            }-->
            
            <div class="accordion-group top-gutter" data-accordion-group>
                <div class="accordion accordion-sm">
                    <div class="accordion-heading collapsed" data-toggle="collapse">
                        <h4 class="main-heading">More details...</h4>
                    </div>
                    <div class="accordion-content collapse">
                        <div class="top-gutter bottom-gutter">
                            @if (mention['Update date']) {
                                <p><strong>Update Date:</strong> {{ mention['Update date'] }}</p>
                            }
                            @if (mention['Publish date']) {
                                <p><strong>Publish Date:</strong> {{ mention['Publish date'] }}</p>
                            }
                            @if (mention.Ranking) {
                                <p><strong>Ranking:</strong> {{ mention.Ranking }}</p>
                            }
                            @if (mention['Media type']) {
                                <p><strong>Media Type:</strong> {{ mention['Media type'] }}</p>
                            } 
                            @if (mention.Country) {
                                <p><strong>Country:</strong> {{ mention.Country }}</p>
                            } 
                            @if (mention.Language) {
                                <p><strong>Language:</strong> {{ mention.Language }}</p>
                            } 
                            @if (mention.Audience) {
                                <p><strong>Audience:</strong> {{ mention.Audience }}</p>
                            } 
                            @if (mention.Reach) {
                                <p><strong>Reach:</strong> {{ mention.Reach }}</p>
                            } 
                            @if (mention.Interactions) {
                                <p><strong>Interactions:</strong> {{ mention.Interactions }}</p>
                            } 
                            @if (mention.Notes) {
                                <p><strong>Notes:</strong> {{ mention.Notes }}</p>
                            } 
                            @if (mention['Author name']) {
                                <p><strong>Author:</strong> {{ mention['Author name'] }}</p>
                            } 
                            @if (mention['Author handle (@username)']) {
                                <p><strong>Author Handle:</strong> {{ mention['Author handle (@username)'] }}</p>
                            } 
                            @if (mention['Author URL']) {
                                <p><strong>Author URL: </strong>
                                    <a [href]="mention['Author URL']" target="_blank">{{ mention['Author URL'] }}</a>
                                </p>
                            } 
                            @if (mention.Gender) {
                                <p><strong>Gender:</strong> {{ mention.Gender }}</p>
                            } 
                            @if (mention.Age) {
                                <p><strong>Age:</strong> {{ mention.Age }}</p>
                            } 
                            @if (mention.Bio) {
                                <p><strong>Biography:</strong> {{ mention.Bio }}</p>
                            } 
                            @if (mention.City) {
                                <p><strong>City:</strong> {{ mention.City }}</p>
                            }                     
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="column--xs-12 column--xl-3">
            <div style="display: flex; flex-direction: column; align-items:stretch; justify-content: stretch;">
                 @if (mention['Media type'] == 'X (Twitter)') {
                    <button type="button" class="btn btn-default btn-block btn-width-medium" style="margin-bottom: 1rem;" data-toggle="modal" data-target="#replyXDialog">
                       <span class="fa fa-reply" aria-hidden="true"></span> Reply in X
                    </button>
                }
                <button class="btn btn-default btn-block btn-width-medium" style="margin-bottom: 1rem;"
                        (click)="toggleResolved()"
                        [disabled]="isResolving">
                    <span class="fa" [ngClass]="mention.Resolved ? 'fa-undo' : 'fa-check-circle'" aria-hidden="true"></span>
                    {{ mention.Resolved ? 'Mark as unresolved' : 'Mark as resolved' }}
                </button>
                @if (!isEditing) {
                <button class="btn btn-primary btn-block btn-width-medium" style="margin-bottom: 1rem;" (click)="startEdit()"><span
                        class="fa fa-pencil" aria-hidden="true"></span>Edit</button>
                }
                @if (isEditing) {
                <button class="btn btn-success btn-block btn-width-medium" style="margin-bottom: 1rem;" (click)="saveChanges()"><span
                        class="fa fa-floppy-o" aria-hidden="true"></span>Save</button>
                }
                @if (isEditing) {
                <button class="btn btn-danger btn-block btn-width-medium" style="margin-bottom: 1rem;" (click)="cancelEdit()"><span
                        class="fa fa-ban" aria-hidden="true"></span>Cancel</button>
                }
                @if (!isEditing) {
                <button class="btn btn-danger btn-block btn-width-medium" style="margin-bottom: 1rem;" (click)="deleteMention()"><span
                        class="fa fa-trash" aria-hidden="true"></span>Delete</button>
                }
                <button class="btn btn-outline-dark btn-block btn-width-medium" style="margin-bottom: 1rem;" (click)="goBack()"><span
                        class="fa fa-angle-left" aria-hidden="true"></span>Back to database</button>
            </div>
        </div>
    </div>
</section>
}

@if (!isLoading && !mention) {
<div>
    <p>Content not found.</p>
    <button class="btn btn-secondary btn-block btn-width-medium" style="margin-bottom: 1rem;" (click)="goBack()"><span
                        class="fa fa-angle-left" aria-hidden="true"></span>Back to database</button>
</div>
}


<div class="modal fade" tabindex="-1" role="dialog" id="replyXDialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Reply in X</h5>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="control-label" for="replyTextarea">Message</label>
          <textarea
            rows="5"
            id="replyTextarea"
            class="form-control"
            placeholder="Reply text"
            [(ngModel)]="replyText">
            </textarea>
          <small class="text-muted">{{ replyText.length || 0 }} chars</small>
        </div>
      </div>
      <div class="modal-footer">
        <div class="btn-link-toolbar">
            <a class="btn btn-link" data-dismiss="modal">Cancel</a>
            <a
            href="#"
            class="btn btn-link"
            (click)="openReply($event)"
            [class.disabled]="!tweetId"
            [attr.aria-disabled]="!tweetId ? true : null">
            Reply
            </a>
        </div>
      </div>
    </div>
  </div>
</div>
